<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>使用react-docgen自动生成组件文档 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="文档,docgen,组件,react,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="背景最近在接到一个开发 React 组件库的需求，组件库在开发过程中，刚写完一个组件打算给同事用，同事立马来了个灵魂拷问“啊？这个组件怎么用”。emmm，我寻思直接告诉它下一次又忘了，还是老老实实写个文档吧。 文档写到一半，@#%#¥……#@麻烦死了。这么多组件，每个组件都需要有对应的文档，写起来太耗时了，手写文档比写个组件还麻烦。为了能快点完（xia）成（ban）任（hui）务（jia）。于是研"><meta name="keywords" content="react,组件,docgen,文档"><meta property="og:type" content="article"><meta property="og:title" content="使用react-docgen自动生成组件文档"><meta property="og:url" content="https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="背景最近在接到一个开发 React 组件库的需求，组件库在开发过程中，刚写完一个组件打算给同事用，同事立马来了个灵魂拷问“啊？这个组件怎么用”。emmm，我寻思直接告诉它下一次又忘了，还是老老实实写个文档吧。 文档写到一半，@#%#¥……#@麻烦死了。这么多组件，每个组件都需要有对应的文档，写起来太耗时了，手写文档比写个组件还麻烦。为了能快点完（xia）成（ban）任（hui）务（jia）。于是研"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/7/25/17386074a8124686?w=2580&h=1724&f=png&s=293455"><meta property="og:updated_time" content="2020-08-25T03:05:37.727Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用react-docgen自动生成组件文档"><meta name="twitter:description" content="背景最近在接到一个开发 React 组件库的需求，组件库在开发过程中，刚写完一个组件打算给同事用，同事立马来了个灵魂拷问“啊？这个组件怎么用”。emmm，我寻思直接告诉它下一次又忘了，还是老老实实写个文档吧。 文档写到一半，@#%#¥……#@麻烦死了。这么多组件，每个组件都需要有对应的文档，写起来太耗时了，手写文档比写个组件还麻烦。为了能快点完（xia）成（ban）任（hui）务（jia）。于是研"><meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2020/7/25/17386074a8124686?w=2580&h=1724&f=png&s=293455"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="https://img11.360buyimg.com/imagetools/jfs/t1/130776/40/5374/245181/5f1e34d7Eaa6f1bf4/bbc19f2f98f318a0.jpg" alt="使用react-docgen自动生成组件文档"></div><header class="post-hd"><h1 class="post-tit">使用react-docgen自动生成组件文档</h1><div class="post-meta">by <a target="_blank" href="https://github.com/" class="post-author">朱鸣辉</a> on <span>2020-07-27</span></div><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><h2 id="背景" class="post-heading"><a href="#背景" class="headerlink" title="背景"></a>背景<a class="post-anchor" href="#背景" aria-hidden="true"></a></h2><p>最近在接到一个开发 React 组件库的需求，组件库在开发过程中，刚写完一个组件打算给同事用，同事立马来了个灵魂拷问“啊？这个组件怎么用”。emmm，我寻思直接告诉它下一次又忘了，还是老老实实写个文档吧。</p><p>文档写到一半，@#%#¥……#@麻烦死了。这么多组件，每个组件都需要有对应的文档，写起来太耗时了，手写文档比写个组件还麻烦。为了能快点完（xia）成（ban）任（hui）务（jia）。于是研究下那些<strong>优秀的组件库</strong>到底是怎么做的，看了下京东凹凸实验室的<code>Quark</code>夸克组件库的文档生成，大受启发，以下内容是讲讲关于如何优雅地偷懒并把组件文档都做好的。</p><h2 id="为什么要自动生成文档" class="post-heading"><a href="#为什么要自动生成文档" class="headerlink" title="为什么要自动生成文档"></a>为什么要自动生成文档<a class="post-anchor" href="#为什么要自动生成文档" aria-hidden="true"></a></h2><p>聊这个事情之前，我们先看看文档希望长什么样子</p><p><img src="https://user-gold-cdn.xitu.io/2020/7/25/17386074a8124686?w=2580&amp;h=1724&amp;f=png&amp;s=293455" alt="组件文档"></p><p>组件文档需要什么内容</p><ul><li>提供组件的介绍说明</li><li>提供组件的属性列表 <code>propTypes</code></li><li>提供组件调用的案例 <code>usage</code></li><li>提供组件调用的演示案例/源码</li></ul><p>如果要把这些内容都通过 <code>markdown</code> 去写，写完耗费的时间可能比做一个简单的组件还多，为了把更多的精力投入到开发更优质的组件当中，我们需要<strong>文档生成自动化</strong>。</p><p>文档自动化后能为我们带来什么？</p><ul><li><strong>统一</strong>文档格式，抹平不同开发者写文档的格式差异</li><li><strong>节省</strong>写文档的时间来做更多有意（tou）义（lan）的事情</li></ul><p>我们拿一个小案例来尝试一下</p><h2 id="react-docgen" class="post-heading"><a href="#react-docgen" class="headerlink" title="react-docgen"></a>react-docgen<a class="post-anchor" href="#react-docgen" aria-hidden="true"></a></h2><p>开始进入正题，先简单介绍下文档自动生成的主角 <code>react-docgen</code> ，官方对于它的介绍是这样的：</p><blockquote><p>react-docgen 是一个 CLI 和工具箱，可帮助从 React 组件中提取信息并从中生成文档。它使用 ast 类型和@ babel / parser 将源解析为 AST，并提供处理此 AST 的方法以提取所需的信息。输出/返回值是一个 JSON blob / JavaScript 对象。</p></blockquote><p><strong>简单来说就是：它能提取组件的相关信息</strong></p><h3 id="安装" class="post-heading"><a href="#安装" class="headerlink" title="安装"></a>安装<a class="post-anchor" href="#安装" aria-hidden="true"></a></h3><p>用 yarn 或 npm 安装模块：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">add</span> react-docgen <span class="comment">--dev</span></span><br><span class="line"></span><br><span class="line">npm install <span class="comment">--save-dev react-docgen</span></span><br></pre></td></tr></table></figure><blockquote><p>关于它的 API 可以参考官方文档 <a href="https://www.npmjs.com/package/react-docgen" target="_blank" rel="noopener">https://www.npmjs.com/package/react-docgen</a></p></blockquote><blockquote><p>偷偷再分享一个高级版的 <code>react-styleguidist</code> <a href="https://github.com/styleguidist/react-styleguidist" target="_blank" rel="noopener">https://github.com/styleguidist/react-styleguidist</a></p></blockquote><h3 id="例子" class="post-heading"><a href="#例子" class="headerlink" title="例子"></a>例子<a class="post-anchor" href="#例子" aria-hidden="true"></a></h3><p>我们先写一个人物的组件，里面包含 <code>姓名</code>、<code>爱好</code>、<code>事件回调</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./Persion/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 人物组件</span></span><br><span class="line"><span class="comment">* @description 这是关于人物组件的描述内容</span></span><br><span class="line"><span class="comment">* @class Persion</span></span><br><span class="line"><span class="comment">* @extends &#123;Component&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Persion</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 处理睡觉的回调</span></span><br><span class="line"><span class="comment">   * @param &#123;string&#125; name 姓名</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleSleep = <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 开始睡觉`</span>)</span><br><span class="line">    <span class="keyword">this</span>.props.onSleep()</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, hobbies &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div onClick=&#123;<span class="keyword">this</span>.handleSleep.bind(<span class="keyword">this</span>, name)&#125;&gt;</span><br><span class="line">        &lt;p&gt;姓名：&#123;name&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;爱好：&#123;hobbies.join(',')&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Persion.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  /</span>**</span><br><span class="line">   * 姓名</span><br><span class="line">   *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  name: PropTypes.string.isRequired,</span></span><br><span class="line"><span class="regexp">  /</span>**</span><br><span class="line">   * 爱好</span><br><span class="line">   *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  hobbies: PropTypes.array,</span></span><br><span class="line"><span class="regexp">  /</span>**</span><br><span class="line">   * 睡觉的事件回调</span><br><span class="line">   *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  onSleep: PropTypes.func</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Persion.defaultProps = &#123;</span></span><br><span class="line"><span class="regexp">  name: '张三',</span></span><br><span class="line"><span class="regexp">  hobbies: ['睡觉', '打王者']</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Persion</span></span><br></pre></td></tr></table></figure><p>我们定义了一个人物的组件，在组件<strong>类注释</strong>中描述了组件的基本信息, 同时在<code>propTypes</code>和<code>defaultTypes</code>中也对组件的属性参数进行了定义和<strong>属性注释</strong></p><p>组件的基本信息都写的差不多了，那么我们先开始使用<code>react-docgen</code>去提取组件的相关信息。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./docgen.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs-extra'</span>)</span><br><span class="line"><span class="keyword">const</span> reactDocs = <span class="built_in">require</span>(<span class="string">'react-docgen'</span>)</span><br><span class="line"><span class="keyword">const</span> prettier = <span class="built_in">require</span>(<span class="string">'prettier'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line"><span class="keyword">const</span> content = fs.readFileSync(path.resolve(<span class="string">'./Persion/index.jsx'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">// 提取组件信息</span></span><br><span class="line"><span class="keyword">const</span> componentInfo = reactDocs.parse(content)</span><br><span class="line"><span class="comment">// 打印信息</span></span><br><span class="line"><span class="built_in">console</span>.log(componentInfo)</span><br></pre></td></tr></table></figure><p>这里写了一个简单的读取文件和解析的过程，并把提取到的信息打印出来，以下是组件信息提取后的内容 <code>componentInfo</code></p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"description"</span>:<span class="string">"</span></span><br><span class="line"><span class="string">        人物组件</span></span><br><span class="line"><span class="string">        @description 这是关于人物组件的描述内容</span></span><br><span class="line"><span class="string">        @class Persion</span></span><br><span class="line"><span class="string">        @extends &#123;Component&#125;"</span></span><br><span class="line">     ,</span><br><span class="line">    <span class="string">"displayName"</span>:<span class="string">"Persion"</span>,</span><br><span class="line">    <span class="string">"methods"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>:<span class="string">"handleSleep"</span>,</span><br><span class="line">            <span class="string">"docblock"</span>:<span class="string">"</span></span><br><span class="line"><span class="string">                处理睡觉的回调</span></span><br><span class="line"><span class="string">                @param name 姓名</span></span><br><span class="line"><span class="string">            "</span>,</span><br><span class="line">            <span class="string">"modifiers"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"params"</span>:[</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                    <span class="string">"description"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                    <span class="string">"type"</span>:&#123;</span><br><span class="line">                        <span class="string">"name"</span>:<span class="string">"string"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"optional"</span><span class="symbol">:false</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"returns"</span><span class="symbol">:null</span>,</span><br><span class="line">            <span class="string">"description"</span>:<span class="string">"处理睡觉的回调"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"props"</span>:&#123;</span><br><span class="line">        <span class="string">"name"</span>:&#123;</span><br><span class="line">            <span class="string">"type"</span>:&#123;</span><br><span class="line">                <span class="string">"name"</span>:<span class="string">"string"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"required"</span><span class="symbol">:false</span>,</span><br><span class="line">            <span class="string">"description"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">            <span class="string">"defaultValue"</span>:&#123;</span><br><span class="line">                <span class="string">"value"</span>:<span class="string">"'张三'"</span>,</span><br><span class="line">                <span class="string">"computed"</span><span class="symbol">:false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"hobbies"</span>:&#123;</span><br><span class="line">            <span class="string">"type"</span>:&#123;</span><br><span class="line">                <span class="string">"name"</span>:<span class="string">"array"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"required"</span><span class="symbol">:false</span>,</span><br><span class="line">            <span class="string">"description"</span>:<span class="string">"爱好"</span>,</span><br><span class="line">            <span class="string">"defaultValue"</span>:&#123;</span><br><span class="line">                <span class="string">"value"</span>:<span class="string">"['睡觉', '打王者']"</span>,</span><br><span class="line">                <span class="string">"computed"</span><span class="symbol">:false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"onSleep"</span>:&#123;</span><br><span class="line">            <span class="string">"type"</span>:&#123;</span><br><span class="line">                <span class="string">"name"</span>:<span class="string">"func"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"required"</span><span class="symbol">:false</span>,</span><br><span class="line">            <span class="string">"description"</span>:<span class="string">"睡觉的事件回调"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于 react-docgen 提取的信息中，解释下下面几个参数</p><ul><li><code>displayName</code> 组件名称</li><li><code>description</code> 组件的类注释</li><li><code>methods</code> 组件定义的方法</li><li><code>props</code> 组件的属性参数</li></ul><p>其中这里的<code>props</code>是我们组件文档的核心内容，在提取的内容中，已经涵盖了属性的 <strong>属性名、属性描述、类型、默认值、是否必传</strong>。这些内容满足我们阅读组件文档所需要的属性信息。</p><p>有了所需的<code>componentInfo</code>信息之后，下一步我们需要把它转换成 <code>markdown</code> （至于为什么要用 markdown 我就不解释了 8）</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./docgen.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成markdown文档</span></span><br><span class="line">fs.writeFileSync(path.resolve(<span class="string">'./Persion/index.md'</span>), commentToMarkDown(componentInfo))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把react-docgen提取的信息转换成markdown格式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commentToMarkDown</span>(<span class="params">componentInfo</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; props &#125; = componentInfo</span><br><span class="line">  <span class="keyword">const</span> markdownInfo = renderMarkDown(props)</span><br><span class="line">  <span class="comment">// 使用prettier美化格式</span></span><br><span class="line">  <span class="keyword">const</span> content = prettier.format(markdownInfo, &#123;</span><br><span class="line">    parser: <span class="string">'markdown'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderMarkDown</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`## 参数 Props</span></span><br><span class="line"><span class="string">  | 属性 |  类型 | 默认值 | 必填 | 描述 |</span></span><br><span class="line"><span class="string">  | --- | --- | --- | --- | ---|</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;<span class="built_in">Object</span>.keys(props)</span></span></span><br><span class="line"><span class="string"><span class="subst">    .map((key) =&gt; renderProp(key, props[key]))</span></span></span><br><span class="line"><span class="string"><span class="subst">    .join(<span class="string">''</span>)&#125;</span></span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params"><span class="keyword">type</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="keyword">enum</span>: <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span></span><br><span class="line">      <span class="keyword">type</span>.value.map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.value.replace(<span class="regexp">/'/g</span>, <span class="string">''</span>)).join(<span class="string">' \\| '</span>),</span><br><span class="line">    union: <span class="function">(<span class="params"><span class="keyword">type</span></span>) =&gt;</span> <span class="keyword">type</span>.value.map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.name).join(<span class="string">' \\| '</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> handler[<span class="keyword">type</span>.name] === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> handler[<span class="keyword">type</span>.name](<span class="keyword">type</span>).replace(<span class="regexp">/\|/g</span>, <span class="string">''</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">type</span>.name.replace(<span class="regexp">/\|/g</span>, <span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染1行属性</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderProp</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  name,</span></span></span><br><span class="line"><span class="function"><span class="params">  &#123; <span class="keyword">type</span> = &#123; name: '-' &#125;, defaultValue = &#123; value: '-' &#125;, required, description &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`| <span class="subst">$&#123;name&#125;</span> | <span class="subst">$&#123;getType(<span class="keyword">type</span>)&#125;</span> | <span class="subst">$&#123;defaultValue.value.replace(</span></span></span><br><span class="line"><span class="string"><span class="subst">    <span class="regexp">/\|/g</span>,</span></span></span><br><span class="line"><span class="string"><span class="subst">    <span class="string">'&lt;span&gt;|&lt;/span&gt;'</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  )&#125;</span> | <span class="subst">$&#123;required ? <span class="string">'✓'</span> : <span class="string">'✗'</span>&#125;</span> |  <span class="subst">$&#123;description || <span class="string">'-'</span>&#125;</span> |</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的转换 markdown 的代码其实做的事情比较少，主要是以下几个步骤</p><ol><li>遍历<code>props</code>对象中的每个属性，</li><li>解析属性<code>prop</code>，提取<code>属性名</code>、<code>类型</code>、<code>默认值</code>、<code>必填</code>、<code>描述</code>、生成对应的 markdown 表格行。</li><li>生成 markdown 内容，通过<code>prettier</code>美化 markdown 代码。</li></ol><p>经过转换后最终生成我们这个 markdown 的文件</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 参数 Props</span></span><br><span class="line"></span><br><span class="line">|<span class="string"> 属性    </span>|<span class="string"> 类型   </span>|<span class="string"> 默认值             </span>|<span class="string"> 必填 </span>|<span class="string"> 描述           </span>|</span><br><span class="line">|<span class="string"> ------- </span>|<span class="string"> ------ </span>|<span class="string"> ------------------ </span>|<span class="string"> ---- </span>|<span class="string"> -------------- </span>|</span><br><span class="line">|<span class="string"> name    </span>|<span class="string"> string </span>|<span class="string"> '张三'             </span>|<span class="string"> ✗    </span>|<span class="string"> 姓名           </span>|</span><br><span class="line">|<span class="string"> hobbies </span>|<span class="string"> array  </span>|<span class="string"> ['睡觉', '打王者'] </span>|<span class="string"> ✗    </span>|<span class="string"> 爱好           </span>|</span><br><span class="line">|<span class="string"> onSleep </span>|<span class="string"> func   </span>|<span class="string"> -                  </span>|<span class="string"> ✗    </span>|<span class="string"> 睡觉的事件回调 </span>|</span><br></pre></td></tr></table></figure><h3 id="拓展优化" class="post-heading"><a href="#拓展优化" class="headerlink" title="拓展优化"></a>拓展优化<a class="post-anchor" href="#拓展优化" aria-hidden="true"></a></h3><p>这个案例只简单讲述了如何解析<code>props</code>并生成 markdown 的<strong>参数 Props</strong>模块的流程，在现实项目中，以上流程还有很多可以优化的空间，我们还可以通过很多自定义规则进行各种骚操作。</p><p>比如我们不希望把参数的<strong>数据属性</strong>（name、hobbies）和<strong>回调属性</strong>（onSleep）都放到同一个 Props 表格中，我们希望可以进行属性上的分类。</p><p>在属性描述的注释中，我们可以通过 @xx （或者 ¥%#@^!【】……你喜欢就好）进行不同的描述定义和分类，最终在属性解析的步骤中进行信息的深度的拆分解析分类，生成更加复杂多元的文档。</p><p>经过一些改造后，我们通过在<strong>注释中添加不同规则的定义描述</strong>，得到更优雅美观的文档模块</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Persion</span>.</span></span>propTypes = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @text 姓名</span></span><br><span class="line"><span class="comment">   * @category data</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  name: <span class="module-access"><span class="module"><span class="identifier">PropTypes</span>.</span></span><span class="built_in">string</span>.isRequired,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @text 爱好</span></span><br><span class="line"><span class="comment">   * @category data</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  hobbies: <span class="module-access"><span class="module"><span class="identifier">PropTypes</span>.</span></span><span class="built_in">array</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @text 睡觉的事件回调</span></span><br><span class="line"><span class="comment">   * @category event</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onSleep: <span class="module-access"><span class="module"><span class="identifier">PropTypes</span>.</span></span>func</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 数据 Data</span></span><br><span class="line"></span><br><span class="line">|<span class="string"> 属性    </span>|<span class="string"> 类型   </span>|<span class="string"> 默认值             </span>|<span class="string"> 必填 </span>|<span class="string"> 描述 </span>|</span><br><span class="line">|<span class="string"> ------- </span>|<span class="string"> ------ </span>|<span class="string"> ------------------ </span>|<span class="string"> ---- </span>|<span class="string"> ---- </span>|</span><br><span class="line">|<span class="string"> name    </span>|<span class="string"> string </span>|<span class="string"> '张三'             </span>|<span class="string"> ✗    </span>|<span class="string"> 姓名 </span>|</span><br><span class="line">|<span class="string"> hobbies </span>|<span class="string"> array  </span>|<span class="string"> ['睡觉', '打王者'] </span>|<span class="string"> ✗    </span>|<span class="string"> 爱好 </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment">## 事件 Event</span></span><br><span class="line"></span><br><span class="line">|<span class="string"> 属性    </span>|<span class="string"> 类型 </span>|<span class="string"> 默认值 </span>|<span class="string"> 必填 </span>|<span class="string"> 描述           </span>|</span><br><span class="line">|<span class="string"> ------- </span>|<span class="string"> ---- </span>|<span class="string"> ------ </span>|<span class="string"> ---- </span>|<span class="string"> -------------- </span>|</span><br><span class="line">|<span class="string"> onSleep </span>|<span class="string"> func </span>|<span class="string"> -      </span>|<span class="string"> ✗    </span>|<span class="string"> 睡觉的事件回调 </span>|</span><br></pre></td></tr></table></figure><p>当然还有很多比如<code>description</code>或者<code>methods</code>等都可以进行不同的解析并生成对应的<code>markdown模块</code>，数据信息提取出来了，其实最终怎么进行<code>ast</code>解析取决自身的具体业务要求。</p><h2 id="小结" class="post-heading"><a href="#小结" class="headerlink" title="小结"></a>小结<a class="post-anchor" href="#小结" aria-hidden="true"></a></h2><p>在日常开发的过程中，我们除了组件的代码编写外，还有很多流程上、边角上的工作需要做，这些事情往往都比较琐碎又必须要做。我们多借助工具去解决我们的工作中那些零星简单的任务，从而达到高（jiu）效（xiang）完（kuai）成（dian）工（xia）作（ban）的目标。开发者都是懒惰的（可能只有我？？），不然怎么会有这么多自动化的产物呢～</p><hr><blockquote><p>参考资料：<br>[1] react-docgen 仓库文档 <a href="https://github.com/reactjs/react-docgen#readme" target="_blank" rel="noopener">https://github.com/reactjs/react-docgen#readme</a></p></blockquote><div class="post-tags" style="display:none"><a href="/tags/react/">react</a> <a href="/tags/组件/">组件</a> <a href="/tags/docgen/">docgen</a> <a href="/tags/文档/">文档</a></div><div class="post-categories" style="display:none"><a href="/cates/经验分享/">经验分享</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/">https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-08-25T03:05:37.727Z">上次更新：2020-08-25 11:05:37</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2020/08/18/design-tokens/" title="Design Tokens —— 设计与开发碰撞的火花">Design Tokens —— 设计与开发碰撞的火花 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2020/07/24/line-height-in-all-hardware/" title="几种移动端多平台元素垂直居中解决方案总结"><i class="fa fa-chevron-left"></i> 几种移动端多平台元素垂直居中解决方案总结</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAyMC8wNy8yNy9ob3ctdG8tdXNlLXJlYWN0LWRvY2",owner:"o2team",repo:"o2team.github.io",title:"使用react-docgen自动生成组件文档",body:"https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/index.html\n\n",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["mamboer"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdrd.jd.com" target="_blank" title="京东零售设计服务平台">京东零售设计服务平台</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>